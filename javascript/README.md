# Javascript

* [이벤트 루프 (Event Loop)](#이벤트-루프-event-loop)
* [함수 선언문 vs 함수 표현식](#함수-선언문-vs-함수-표현식)

* [일급 객체](#일급-객체)

  

## 이벤트 루프 (Event Loop)

자바스크립트는 **단일 스레드** 언어이기 때문에 동시에 하나의 작업만을 처리할 수 있다. 하지만 우리는 자바스크립트를 사용하면서 여러 개의 애니메이션 효과를 보여주면서 이벤트를 처리하기도 하고, HTTP 요청을 처리하는 등 동시에 여러가지 작업을 할 수 있다. 이처럼 자바스크립트의 동시성을 지원해 주는 것이 **이벤트 루프** 이며, 이벤트 루프는 **자바스크립트가 아닌 자바스크립트를 실행하는 환경인 브라우저나 Node.js에서 제공된다.**

### 콜 스택과(Call Stack) 힙(Heap)

대부분의 자바스크립트 엔진은 **콜 스택**과 **힙**으로 이루어져 있다.

* 콜 스택
  * 함수 호출의 실행 컨텍스트가 저장되는 곳이다.
  * 함수를 호출하면 함수 실행 컨텍스트가 순차적으로 콜 스택에 푸시되어 순차적으로 실행된다. 만약 함수의 종료문에 다다를 경우 해당 함수의 실행 컨텍스트는 콜 스택에서 제거(POP) 된다.

> 실행 컨텍스트에 대한 자세한 내용은 추후 실행 컨텍스트에 대해 정리할 때 추가적으로 알아보도록 하겠다. (아직 미완)

* 힙
  * 객체와 같이 할당해야할 메모리 공간의 크기가 런타임에 결정(동적 할당) 되는 값을 저장하는 곳이다.
  * 따라서 힙은 구조화되어 있지 않다는 특징이 있다.

콜 스택과 힙으로 구성되어 있는 자바스크립트 엔진은 **단순히 태스크가 요청되면 콜 스택을 통해 요청된 작업을 순차적으로 실행**할 뿐이다. 비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 자바스크립트 엔진을 구동하는 환경인 브라우저 또는 Node.js가 담당한다. 이를 처리하기 위해 브라우저 환경은 태스크 큐와 이벤트 루프를 제공한다.



### 태스크 큐 (Task Queue)

`setTimeout` ,`setInterval` 같은 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역이다. 별도로 마이크로태스크 큐도 존재한다.



### 마이크로태스크 큐 (MicroTask Queue)

Promise의 후속 처리 메서드의 콜백 함수 (`Promise.then` 등) 가 일시적으로 보관되는 영역이다. **이벤트 루프는 태스크 큐를 확인하기 전에 마이크로태스크  큐를 먼저 확인하고 이를 처리한다.**



### 이벤트 루프

이벤트 루프는 콜 스택에 현재 실행중인 함수가 있는지, 그리고 태스크 큐에 대기 중인 함수(콜백 함수, 이벤트 핸들러 등) 이 있는지 반복해서 확인한다. **만약 콜 스택이 비어있고, 태스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적으로 태스크 큐에 있는 함수를 콜 스택으로 이동시키고 실행한다.** 이를 통해 우리는 단일스레드 언어인 자바스크립트 환경에서 비동기 처리 방식을 사용할 수 있다.



### 코드로 보는 예제

```javascript
console.log('script start'); 

setTimeout(function() {
  console.log('setTimeout');
}, 0);

Promise.resolve().then(function() {
  console.log('promise then');
});

console.log('script end');
```

1. `console.log('script start'); ` 태스크가 콜 스택에 들어가 실행된다.
2. `console.log('setTimeout');` 태스크가 태스크 큐에 들어가게 된다.
3. `console.log('promise then');` 태스크가 마이크로태스크 큐에 들어가게 된다.
4. `console.log('script end');` 태스크가 콜 스택에 들어가 실행된다.
5. 콜 스택이 비어있기 때문에 이벤트 루프는 마이크로 태스크 큐를 확인하고 `  console.log('promise then');` 태스크를 콜스택에 푸시하고 실행한다.
6. 콜 스택이 비어있고 마이크로태스크 큐가 비어있기 때문에 이벤트 루프는 태스크 큐를 확인하고 `console.log('setTimeout');` 태스크를 콜스택에 푸시하고 실행한다.



따라서 콘솔에 출력되는 값은 다음과 같다.

```javascript
script start
script end
promise1
setTimeout
```



### 참고한 내용

 모던 자바스크립트 Deep Dive 42장 - 비동기 프로그래밍

[자바스크립트와 이벤트 루프](https://meetup.toast.com/posts/89)

[어쨌든 이벤트 루프는 무엇입니까? 유튜브 영상](https://www.youtube.com/watch?v=8aGhZQkoFbQ)



## 함수 선언문 vs 함수 표현식

### 함수 선언문

일반적으로 프로그래밍 언어에서의 함수를 사용하는 방식과 동일하다. 함수 선언문은 **함수 이름을 생략할 수 없다.** 

```javascript
function add(x, y) {
  return x + y;
}
```



### 함수 표현식

자바스크립트의 함수는 **객체 타입의 값이기 때문에** 변수에 할당해 사용할 수 있다. 변수에 함수를 할당시켜 놓은 값을 **함수 표현식**이라 한다.

```javascript
var add = function (x, y) {
  return x + y;
}
```

함수 표현식에서는 함수 리터럴의 함수 이름을 생략할 수 있다. 함수 표현식에서는 일반적으로 함수의 이름을 생략하지만 생략되지 않았을 경우 호출할 때는 **함수 이름이 아닌 함수 객체를 가리키는 식별자를 통해 호출**해야 한다. 함수 이름은 함수 몸체 내부에서만 유효한 식별자이기 때문이다.



함수 이름이 생략되어 있는 함수 표현식을 **익명 함수 표현식**, 생략되어 있지 않은 함수 표현식을 **기명 함수 표현식**이라 한다.

```javascript
var add = function foo (x, y) {
  return x + y;
}

console.log(add(2, 5)); // 7

console.log(foo(2, 5)); // ReferenceError: foo is not defined
```



> 함수 이름은 함수 몸체 내부에서만 유효한 식별자인데, 함수 선언문은 어떻게 호출할 수 있을까?

함수 이름은 함수 몸체 내부에서만 유효한 식별자이기 때문에 실질적으로 함수 선언문은 호출될 수 없어야 하는게 맞다. 하지만 자바스크립트 엔진은 함수를 호출하기 위해 **함수 이름과 동일한 식별자를 암묵적으로 생성하고, 해당 식별자에 함수를 할당한다.** 



실질적으로 함수 선언문을 선언할 경우 다음과 같이 사용된다.

```javascript
function add(x, y) {
  return x + y;
}

// 변환
var add = function add(x, y) {
  return x + y;
}
```



### 참고한 내용

 모던 자바스크립트 Deep Dive 12장 - 함수

[[JavaScript] 함수선언문과 함수표현식의 차이](https://gmlwjd9405.github.io/2019/04/20/function-declaration-vs-function-expression.html)



## 일급 객체

일급 객체란 다음 조건을 만족하는 객체를 뜻한다.

* 변수나 자료구조 (배열 등) 에 담을 수 있다.
* 함수의 파라미터로 전달할 수 있다.
* 함수의 반환값으로 사용할 수 있다.
* 무명의 리터럴로 생성이 가능하다. (런타임에 생성이 가능하다)



자바스크립트의 함수와 클래스도 일급 객체이다.

### 참고

[Javascript에서 왜 함수가 1급 객체일까요?](https://soeunlee.medium.com/javascript%EC%97%90%EC%84%9C-%EC%99%9C-%ED%95%A8%EC%88%98%EA%B0%80-1%EA%B8%89-%EA%B0%9D%EC%B2%B4%EC%9D%BC%EA%B9%8C%EC%9A%94-cc6bd2a9ecac)
